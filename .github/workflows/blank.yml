name: Windows-2025 Cloud Computer

on:
  workflow_dispatch:

jobs:
  setup-cloud-pc:
    runs-on: windows-2025
    steps:
      - name: Download AnyViewer Portable
        shell: pwsh
        run: |
          $url = "https://dl.anyviewer.com/noinstall/AnyViewer.exe"
          $output = "$env:TEMP\AnyViewer.exe"
          Write-Output "Downloading AnyViewer Portable..."
          Invoke-WebRequest -Uri $url -OutFile $output
          Write-Output "Downloaded to $output"

      - name: Configure AnyViewer (Password = bear)
        shell: pwsh
        run: |
          $configPath = "$env:TEMP\AnyViewer.ini"
          Write-Output "Configuring AnyViewer with password..."
          Set-Content -Path $configPath -Value "[general]`npassword=bear" -Encoding ASCII

      - name: Start AnyViewer
        shell: pwsh
        run: |
          $exe = "$env:TEMP\AnyViewer.exe"
          $config = "$env:TEMP\AnyViewer.ini"
          if (Test-Path $exe) {
            Write-Output "Starting AnyViewer..."
            Start-Process $exe -ArgumentList "/config $config"
            Start-Sleep -Seconds 15
          } else {
            Write-Error "AnyViewer.exe not found!"
            exit 1
          }

      - name: Show Cloud PC Info
        shell: pwsh
        run: |
          Write-Output "ğŸ’» Your personal cloud computer is ready!"
          Write-Output "ğŸ–¥ï¸ Specs:"
          Write-Output "   â€¢ OS: Windows Server 2025 (Cloud Edition)"
          Write-Output "   â€¢ RAM: 8â€“16 GB"
          Write-Output "   â€¢ Storage: 256 GB (C:) + smaller D: drive"
          Write-Output "   â€¢ CPU: AMD EPYC (2â€“4 vCores)"

          # Try to read AnyViewer Device ID from registry
          $deviceId = (Get-ItemProperty "HKLM:\SOFTWARE\AnyViewer").DeviceID 2>$null
          if ($deviceId) {
            Write-Output "ğŸ†” Device ID: $deviceId"
          } else {
            Write-Output "ğŸ†” Device ID: (not detected yet, wait a few seconds after launch)"
          }

          Write-Output "ğŸ”‘ Password: bear"
          Write-Output "ğŸ“± Connect using AnyViewer on your PC or phone."

      - name: Keep Alive for 6 Hours
        shell: pwsh
        run: |
          $hours = 6
          $minutes = $hours * 60
          for ($i = 1; $i -le $minutes; $i++) {
            Write-Output "â³ [$i/$minutes] Your cloud computer is still running..."
            Start-Sleep -Seconds 60
