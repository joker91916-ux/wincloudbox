name: Windows-2025 Personal Cloud PC (Supremo)

on:
  workflow_dispatch:
    inputs:
      pin:
        description: 'PIN for your Cloud PC (4-6 digits)'
        required: true
      name:
        description: 'Friendly name for your Cloud PC'
        required: true

jobs:
  cloud-pc-job:
    runs-on: windows-2025
    steps:
      - name: ‚òÅÔ∏è Cloud PC: Download Supremo
        shell: pwsh
        run: |
          $url = "https://www.nanosystems.it/public/download/Supremo.exe"
          $output = "$env:TEMP\Supremo.exe"
          Write-Output "Downloading Supremo..."
          Invoke-WebRequest -Uri $url -OutFile $output
          Write-Output "Supremo downloaded to $output"

      - name: ‚ö° Cloud PC: Start Supremo
        shell: pwsh
        run: |
          $pin = '${{ github.event.inputs.pin }}'
          $cloudPCName = '${{ github.event.inputs.name }}'
          $supremoPath = "$env:TEMP\Supremo.exe"

          Write-Output "Starting Cloud PC '$cloudPCName'..."
          Start-Process -FilePath $supremoPath -ArgumentList "/PIN $pin /NAME $cloudPCName /RUN" -WindowStyle Hidden
          Start-Sleep -Seconds 5

          Write-Output "üíª Cloud PC '$cloudPCName' is running!"
          Write-Output "üîë PIN: $pin"
          Write-Output "Connect using Supremo app on Android or PC."

      - name: ‚è≥ Cloud PC: Ready to Use!
        shell: pwsh
        run: |
          $pin = '${{ github.event.inputs.pin }}'
          $cloudPCName = '${{ github.event.inputs.name }}'
          $durationHours = 5
          $durationSeconds = $durationHours * 3600
          $startTime = Get-Date

          while ((Get-Date) - $startTime -lt (New-TimeSpan -Seconds $durationSeconds)) {
              $elapsed = (Get-Date) - $startTime
              $remaining = New-TimeSpan -Seconds ($durationSeconds - $elapsed.TotalSeconds)
              $minutes = [math]::Floor($remaining.TotalMinutes)
              $seconds = $remaining.Seconds

              Write-Output "üéâ Enjoy your Cloud PC '$cloudPCName'! üíª"
              Write-Output "üîë PIN: $pin"
              Write-Output "‚è±Ô∏è Time remaining: $minutes minutes, $seconds seconds"
              Start-Sleep -Seconds 5
          }

          Write-Output "‚è∞ 5 hours reached. Cloud PC job completed. ‚úÖ"
