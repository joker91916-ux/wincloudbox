name: Windows-2025 Cloud Computer (Chrome Remote Desktop)

on:
  workflow_dispatch:
    inputs:
      crd_code:
        description: 'Chrome Remote Desktop setup code from your Google account'
        required: true
      pin:
        description: 'PIN for your cloud computer'
        required: true
      name:
        description: 'Name for your cloud computer'
        required: true

jobs:
  setup-cloud-pc:
    runs-on: windows-2025
    steps:
      - name: Download CRD Host
        shell: pwsh
        run: |
          $url = "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi"
          $output = "$env:TEMP\CRDHost.msi"
          Write-Output "Downloading Chrome Remote Desktop Host..."
          Invoke-WebRequest -Uri $url -OutFile $output
          Write-Output "Downloaded to $output"

      - name: Install CRD Host
        shell: pwsh
        run: |
          $installer = "$env:TEMP\CRDHost.msi"
          Write-Output "Installing CRD Host..."
          Start-Process msiexec.exe -ArgumentList "/i `"$installer`" /quiet /norestart" -Wait
          Write-Output "Installation complete."
          Start-Sleep -Seconds 5

      - name: Configure and Start CRD Host
        shell: pwsh
        run: |
          $code = "${{ github.event.inputs.crd_code }}"
          $pin = "${{ github.event.inputs.pin }}"
          $name = "${{ github.event.inputs.name }}"
          Write-Output "Configuring Chrome Remote Desktop Host..."
          & "C:\Program Files\Chrome Remote Desktop\remotedesktop_host.exe" `
            --code $code `
            --pin $pin `
            --name $name `
            --enable-remote-access
          Write-Output "üíª Cloud PC '$name' is configured and ready!"

      - name: Spam Message & Keep Alive for 5 Hours
        shell: pwsh
        run: |
          $durationHours = 5
          $durationSeconds = $durationHours * 3600
          $startTime = Get-Date
          $cloudPCName = "${{ github.event.inputs.name }}"
          $pin = "${{ github.event.inputs.pin }}"
          $ram = "8‚Äì16 GB"
          $storage = "256 GB (C:) + smaller D: drive"
          $cpu = "AMD EPYC (2‚Äì4 vCores)"

          while ((Get-Date) - $startTime -lt (New-TimeSpan -Seconds $durationSeconds)) {
              Write-Output "üéâ Enjoy using your computer! üíª '$cloudPCName'"
              Write-Output "üñ•Ô∏è Specs: RAM: $ram | Storage: $storage | CPU: $cpu"
              Write-Output "üîë PIN: $pin"
              Write-Output "This computer runs for 6 hours. ‚è∞"
              Write-Output "To get a new cloud computer, simply relaunch this workflow. üöÄ"
              Write-Output "Your new computer will appear on your Chrome Remote Desktop page. üåê"
              Start-Sleep -Seconds 5
          }

          Write-Output "‚è∞ 5 hours reached. Job completed. ‚úÖ"
