name: Windows-2025 Cloud Computer

on:
  workflow_dispatch:

jobs:
  setup-cloud-pc:
    runs-on: windows-2025
    steps:
      - name: Download AnyViewer
        shell: pwsh
        run: |
          $url = "https://dl.anyviewer.com/AnyViewerSetup.exe"
          $output = "$env:TEMP\AnyViewerSetup.exe"
          Write-Output "Downloading AnyViewer..."
          Invoke-WebRequest -Uri $url -OutFile $output
          Write-Output "Downloaded to $output"

      - name: Install AnyViewer
        shell: pwsh
        run: |
          $installer = "$env:TEMP\AnyViewerSetup.exe"
          Write-Output "Installing AnyViewer..."
          Start-Process msiexec.exe -ArgumentList "/i `"$installer`" /quiet /norestart" -Wait
          Write-Output "Installation complete."
          Start-Sleep -Seconds 10

      - name: Configure AnyViewer (Password = bear)
        shell: pwsh
        run: |
          $configPath = "$env:ProgramData\AnyViewer\anyviewer_config.ini"
          if (-Not (Test-Path $env:ProgramData\AnyViewer)) {
              New-Item -ItemType Directory -Path $env:ProgramData\AnyViewer -Force | Out-Null
          }
          # Create config file with password
          Set-Content -Path $configPath -Value "[general]`npassword=bear" -Encoding ASCII

      - name: Start AnyViewer
        shell: pwsh
        run: |
          Start-Process "C:\Program Files (x86)\AnyViewer\AnyViewer.exe"
          Start-Sleep -Seconds 15

      - name: Show Cloud PC Info
        shell: pwsh
        run: |
          Write-Output "ğŸ’» Your personal cloud computer is ready!"
          Write-Output "ğŸ–¥ï¸ Specs:"
          Write-Output "   â€¢ OS: Windows Server 2025 (Cloud Edition)"
          Write-Output "   â€¢ RAM: 8â€“16 GB"
          Write-Output "   â€¢ Storage: 256 GB (C:) + smaller D: drive"
          Write-Output "   â€¢ CPU: AMD EPYC (2â€“4 vCores)"
          
          # Try to read Device ID from registry
          $deviceId = (Get-ItemProperty "HKLM:\SOFTWARE\AnyViewer").DeviceID 2>$null
          if ($deviceId) {
            Write-Output "ğŸ†” Device ID: $deviceId"
          } else {
            Write-Output "ğŸ†” Device ID: (could not detect, check AnyViewer window)"
          }
          Write-Output "ğŸ”‘ Password: bear"
          Write-Output "ğŸ“± Connect using AnyViewer on your PC or phone."

      - name: Keep Alive for 6 Hours
        shell: pwsh
        run: |
          $hours = 6
          $minutes = $hours * 60
          for ($i = 1; $i -le $minutes; $i++) {
            Write-Output "â³ [$i/$minutes] Your cloud computer is still running..."
            Start-Sleep -Seconds 60
